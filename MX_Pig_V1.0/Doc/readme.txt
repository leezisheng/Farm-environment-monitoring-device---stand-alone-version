/*********************************************Project introduction***************************************************************/

1. Project Description:

Nucleo-f103rb development board is used as the main controller to monitor hydrogen sulfide, ammonia, carbon dioxide, 
carbon monoxide concentrations, temperature, humidity and equipment voltage in pig farms through gas sensors, temperature 
and humidity sensors and internal voltage sensors. The ESP826601S module uses MQTT protocol to connect ali Cloud Iot platform 
to display and process data in real time.

2. Introduction to the code:

Software is divided into three layers: Hardware layer, peripheral driver layer (Hardware folder), system layer (Task folder)

(1) Hardware layer
Initialization of chip peripherals, automatically generated by STM32CubeMX

(2) peripheral driver layer
Includes functions for initialization and related operations of external modules (ADC1\DTH11\ESP8266\ buzzer \OLED)

(3) system layer
Includes functions for creating tasks and message queues, and communicating between tasks through message queues

3. The working process:
(1) Initialization of chip peripherals

(2) Initialization of external modules

(3) Enable task scheduling

/************************************************Component correlation***********************************************************/

1.MCU: NUCLEO-F103RB

Timebase Source: TIM1

RCC	BYPASS Clock Source	RCC_OSC_IN	PD0-OSC_IN
RCC	BYPASS Clock Source	RCC_OSC_OUT	PD1-OSC_OUT
RCC	Crystal/Ceramic Resonator	RCC_OSC32_IN	PC14-OSC32_IN
RCC	Crystal/Ceramic Resonator	RCC_OSC32_OUT	PC15-OSC32_OUT
SYS	Serial Wire	SYS_JTCK-SWCLK	PA14
SYS	Serial Wire	SYS_JTMS-SWDIO	PA13

2. OLED : 

OLED0561_ADD			0x78 

I2C1	I2C	I2C1_SCL	PB6
I2C1	I2C	I2C1_SDA	PB7

Master Features:
I2C Speed Mode Standard Mode
I2C Clock Speed (Hz) 100000
Slave Features:
Clock No Stretch Mode Disabled
Primary Address Length selection 7-bit
Dual Address Acknowledged Disabled
Primary slave address 0
General Call address detection Disabled

3.ESP8266: 

USART1 
USART1	Asynchronous	USART1_RX	PA10
USART1	Asynchronous	USART1_TX	PA9

PB12	GPIO_Output	ESP8266_RST
PB13	GPIO_Output	ESP8266_CH_PD

Basic Parameters:
Baud Rate 115200
Word Length 8 Bits (including Parity)
Parity None
Stop Bits 1
Advanced Parameters:
Data Direction Receive and Transmit
Over Sampling 16 Samples

4.USART3-USB T0 TTL:

USART3	Asynchronous	USART3_RX	PB11
USART3	Asynchronous	USART3_TX	PB10

Basic Parameters:
Baud Rate 115200
Word Length 8 Bits (including Parity)
Parity None
Stop Bits 1
Advanced Parameters:
Data Direction Receive and Transmit
Over Sampling 16 Samples

5. DTH11-Data:

PC2	GPIO_Output	DTH11

6.Buzzer && LED2:

PA5	GPIO_Output

7.ADC:

ADC1	IN4	ADC1_IN4	PA4
ADC1	IN6	ADC1_IN6	PA6
ADC1	IN7	ADC1_IN7	PA7
ADC1	IN8	ADC1_IN8	PB0

ADCs_Common_Settings:
Mode Independent mode
ADC_Settings:
Data Alignment Right alignment
Scan Conversion Mode Enabled
Continuous Conversion Mode Disabled
Discontinuous Conversion Mode Enabled *
Number Of Discontinuous Conversions 1
ADC_Regular_ConversionMode:
Enable Regular Conversions Enable
Number Of Conversion 5 *
External Trigger Conversion Source Regular Conversion launched by software
Rank 1
Channel Channel 4
Sampling Time 71.5 Cycles *
Rank 2 *
Channel Channel 6 *
Sampling Time 71.5 Cycles *
Rank 3 *
Channel Channel 7 *
Sampling Time 71.5 Cycles *
Rank 4 *
Channel Channel 8 *
Sampling Time 71.5 Cycles *
Rank 5 *
Channel Channel Vrefint *
Sampling Time 71.5 Cycles *

ADC1: DMA1_Channel1 DMA request Settings:

Mode: Circular *
Peripheral Increment: Disable
Memory Increment: Enable *
Peripheral Data Width: Half Word
Memory Data Width: Half Word

/****************************************************FreeRTOS related***********************************************************/

FreeRTOS API CMSIS v1

FreeRTOS version 10.0.1
CMSIS-RTOS version 1.02

USE_PREEMPTION Enabled
CPU_CLOCK_HZ SystemCoreClock
TICK_RATE_HZ 1000
MAX_PRIORITIES 18 *
MINIMAL_STACK_SIZE 128
MAX_TASK_NAME_LEN 16
USE_16_BIT_TICKS Disabled
IDLE_SHOULD_YIELD Enabled
USE_MUTEXES Enabled
USE_RECURSIVE_MUTEXES Disabled
USE_COUNTING_SEMAPHORES Disabled
QUEUE_REGISTRY_SIZE 8
USE_APPLICATION_TASK_TAG Disabled
ENABLE_BACKWARD_COMPATIBILITY Enabled
USE_PORT_OPTIMISED_TASK_SELECTION Enabled
USE_TICKLESS_IDLE Disabled
USE_TASK_NOTIFICATIONS Enabled
RECORD_STACK_HIGH_ADDRESS Disabled

Memory Allocation Dynamic *
TOTAL_HEAP_SIZE 10240 *
Memory Management scheme heap_4

USE_IDLE_HOOK Disabled
USE_TICK_HOOK Disabled
USE_MALLOC_FAILED_HOOK Disabled
USE_DAEMON_TASK_STARTUP_HOOK Disabled
CHECK_FOR_STACK_OVERFLOW Disabled

GENERATE_RUN_TIME_STATS Disabled
USE_TRACE_FACILITY Disabled
USE_STATS_FORMATTING_FUNCTIONS Disabled

USE_CO_ROUTINES Disabled
MAX_CO_ROUTINE_PRIORITIES 2

USE_TIMERS Disabled

LIBRARY_LOWEST_INTERRUPT_PRIORITY 15
LIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY 5

/************************************************Current shortcomings***********************************************************/
1. System level: coupling between layers is serious, and modularization of functions within layers needs to be optimized
2. The product logic is not well planned
3. The MQTT library communicating with ESP8266 needs to be improved
4. Hardware: PCB board design










